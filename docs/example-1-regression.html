<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Example 1: Regression | Intro to Bayesian Addictive Regression Trees (BART)</title>
  <meta name="description" content="Chapter 3 Example 1: Regression | Intro to Bayesian Addictive Regression Trees (BART)" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Example 1: Regression | Intro to Bayesian Addictive Regression Trees (BART)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Example 1: Regression | Intro to Bayesian Addictive Regression Trees (BART)" />
  
  
  

<meta name="author" content="Jingyi Guan, Alayna Johnson, Wenxuan Zhu" />


<meta name="date" content="2024-04-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-methodology.html"/>
<link rel="next" href="example-2-classification.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BART</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="the-methodology.html"><a href="the-methodology.html"><i class="fa fa-check"></i><b>2</b> The Methodology</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-methodology.html"><a href="the-methodology.html#setting-up"><i class="fa fa-check"></i><b>2.1</b> Setting up</a></li>
<li class="chapter" data-level="2.2" data-path="the-methodology.html"><a href="the-methodology.html#prior-models-and-tuning"><i class="fa fa-check"></i><b>2.2</b> Prior models and tuning</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-methodology.html"><a href="the-methodology.html#the-t_j-prior"><i class="fa fa-check"></i><b>2.2.1</b> The <span class="math inline">\(T_j\)</span> Prior</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-methodology.html"><a href="the-methodology.html#the-mu_ij-t_j-prior"><i class="fa fa-check"></i><b>2.2.2</b> The <span class="math inline">\(\mu_{ij} | T_j\)</span> prior</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-methodology.html"><a href="the-methodology.html#the-sigma-prior"><i class="fa fa-check"></i><b>2.2.3</b> The <span class="math inline">\(\sigma\)</span> prior</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-methodology.html"><a href="the-methodology.html#choosing-m"><i class="fa fa-check"></i><b>2.2.4</b> Choosing m</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="the-methodology.html"><a href="the-methodology.html#backfitting-with-mcmc-algorithm"><i class="fa fa-check"></i><b>2.3</b> Backfitting with MCMC Algorithm</a></li>
<li class="chapter" data-level="2.4" data-path="the-methodology.html"><a href="the-methodology.html#bart-probit-for-classification"><i class="fa fa-check"></i><b>2.4</b> BART Probit for Classification</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="the-methodology.html"><a href="the-methodology.html#what-is-probitprobit-model"><i class="fa fa-check"></i><b>2.4.1</b> What is Probit/Probit Model?</a></li>
<li class="chapter" data-level="2.4.2" data-path="the-methodology.html"><a href="the-methodology.html#setup-bart-for-classification"><i class="fa fa-check"></i><b>2.4.2</b> Setup BART for Classification</a></li>
<li class="chapter" data-level="2.4.3" data-path="the-methodology.html"><a href="the-methodology.html#modification-of-regularization-priors"><i class="fa fa-check"></i><b>2.4.3</b> Modification of Regularization Priors</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="the-methodology.html"><a href="the-methodology.html#references"><i class="fa fa-check"></i><b>2.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="example-1-regression.html"><a href="example-1-regression.html"><i class="fa fa-check"></i><b>3</b> Example 1: Regression</a></li>
<li class="chapter" data-level="4" data-path="example-2-classification.html"><a href="example-2-classification.html"><i class="fa fa-check"></i><b>4</b> Example 2: Classification</a>
<ul>
<li class="chapter" data-level="4.1" data-path="example-2-classification.html"><a href="example-2-classification.html#references-1"><i class="fa fa-check"></i><b>4.1</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to Bayesian Addictive Regression Trees (BART)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-1-regression" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Example 1: Regression<a href="example-1-regression.html#example-1-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="example-1-regression.html#cb1-1" tabindex="-1"></a><span class="co"># install.packages(&quot;countrycode&quot;)</span></span>
<span id="cb1-2"><a href="example-1-regression.html#cb1-2" tabindex="-1"></a><span class="co"># install.packages(&quot;DALEXtra&quot;)</span></span>
<span id="cb1-3"><a href="example-1-regression.html#cb1-3" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-4"><a href="example-1-regression.html#cb1-4" tabindex="-1"></a><span class="co"># devtools::install_github(&#39;bbc/bbplot&#39;)</span></span>
<span id="cb1-5"><a href="example-1-regression.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="example-1-regression.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-7"><a href="example-1-regression.html#cb1-7" tabindex="-1"></a><span class="fu">library</span>(countrycode)</span>
<span id="cb1-8"><a href="example-1-regression.html#cb1-8" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-9"><a href="example-1-regression.html#cb1-9" tabindex="-1"></a><span class="fu">library</span>(sysfonts)</span>
<span id="cb1-10"><a href="example-1-regression.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(showtext)</span>
<span id="cb1-11"><a href="example-1-regression.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-12"><a href="example-1-regression.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-13"><a href="example-1-regression.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb1-14"><a href="example-1-regression.html#cb1-14" tabindex="-1"></a><span class="fu">library</span>(DALEXtra)</span>
<span id="cb1-15"><a href="example-1-regression.html#cb1-15" tabindex="-1"></a><span class="fu">library</span>(bbplot)</span>
<span id="cb1-16"><a href="example-1-regression.html#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="example-1-regression.html#cb1-17" tabindex="-1"></a><span class="co">#Loading the datasets</span></span>
<span id="cb1-18"><a href="example-1-regression.html#cb1-18" tabindex="-1"></a>df_childhood <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/mesdi/blog/main/childhood.csv&quot;</span>)</span>
<span id="cb1-19"><a href="example-1-regression.html#cb1-19" tabindex="-1"></a>df_household <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://raw.githubusercontent.com/mesdi/blog/main/household.csv&quot;</span>)</span>
<span id="cb1-20"><a href="example-1-regression.html#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="example-1-regression.html#cb1-21" tabindex="-1"></a><span class="co">#Joining them by country and time</span></span>
<span id="cb1-22"><a href="example-1-regression.html#cb1-22" tabindex="-1"></a>df <span class="ot">&lt;-</span> </span>
<span id="cb1-23"><a href="example-1-regression.html#cb1-23" tabindex="-1"></a>  df_childhood <span class="sc">%&gt;%</span> </span>
<span id="cb1-24"><a href="example-1-regression.html#cb1-24" tabindex="-1"></a>  <span class="fu">left_join</span>(df_household, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;time&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-25"><a href="example-1-regression.html#cb1-25" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb1-26"><a href="example-1-regression.html#cb1-26" tabindex="-1"></a></span>
<span id="cb1-27"><a href="example-1-regression.html#cb1-27" tabindex="-1"></a><span class="co">#Wrangling the dataset</span></span>
<span id="cb1-28"><a href="example-1-regression.html#cb1-28" tabindex="-1"></a>df_tidy <span class="ot">&lt;-</span> </span>
<span id="cb1-29"><a href="example-1-regression.html#cb1-29" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="example-1-regression.html#cb1-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">household =</span> <span class="fu">round</span>(household, <span class="dv">2</span>),</span>
<span id="cb1-31"><a href="example-1-regression.html#cb1-31" tabindex="-1"></a>         <span class="at">childhood =</span> <span class="fu">round</span>(childhood, <span class="dv">2</span>),</span>
<span id="cb1-32"><a href="example-1-regression.html#cb1-32" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">str_replace</span>(age, <span class="st">&quot;_&quot;</span>, <span class="st">&quot;-&quot;</span>),</span>
<span id="cb1-33"><a href="example-1-regression.html#cb1-33" tabindex="-1"></a>         <span class="at">country_name =</span> <span class="fu">countrycode</span>(country, <span class="st">&quot;genc3c&quot;</span>, <span class="st">&quot;country.name&quot;</span>)</span>
<span id="cb1-34"><a href="example-1-regression.html#cb1-34" tabindex="-1"></a>         )</span>
<span id="cb1-35"><a href="example-1-regression.html#cb1-35" tabindex="-1"></a></span>
<span id="cb1-36"><a href="example-1-regression.html#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="example-1-regression.html#cb1-37" tabindex="-1"></a><span class="co">#Best 20 countries based on the household net worth in their last year</span></span>
<span id="cb1-38"><a href="example-1-regression.html#cb1-38" tabindex="-1"></a>df_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb1-39"><a href="example-1-regression.html#cb1-39" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span> </span>
<span id="cb1-40"><a href="example-1-regression.html#cb1-40" tabindex="-1"></a>  <span class="fu">slice_max</span>(time) <span class="sc">%&gt;%</span> </span>
<span id="cb1-41"><a href="example-1-regression.html#cb1-41" tabindex="-1"></a>  <span class="fu">slice_max</span>(household, <span class="at">n=</span><span class="dv">20</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-42"><a href="example-1-regression.html#cb1-42" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">fct_reorder</span>(age, childhood, <span class="at">.desc =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-43"><a href="example-1-regression.html#cb1-43" tabindex="-1"></a>         <span class="at">country_name =</span> <span class="fu">fct_reorder</span>(country_name, household, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-44"><a href="example-1-regression.html#cb1-44" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>country_name, </span>
<span id="cb1-45"><a href="example-1-regression.html#cb1-45" tabindex="-1"></a>             <span class="at">y=</span>childhood, </span>
<span id="cb1-46"><a href="example-1-regression.html#cb1-46" tabindex="-1"></a>             <span class="at">fill =</span> age,</span>
<span id="cb1-47"><a href="example-1-regression.html#cb1-47" tabindex="-1"></a>             <span class="co">#Hover text of the barplot</span></span>
<span id="cb1-48"><a href="example-1-regression.html#cb1-48" tabindex="-1"></a>             <span class="at">text =</span> <span class="fu">glue</span>(<span class="st">&quot;{country}</span><span class="sc">\n</span><span class="st">%{childhood}</span><span class="sc">\n</span><span class="st">{age}</span><span class="sc">\n</span><span class="st">Childhood education&quot;</span>))) <span class="sc">+</span> </span>
<span id="cb1-49"><a href="example-1-regression.html#cb1-49" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb1-50"><a href="example-1-regression.html#cb1-50" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>household<span class="sc">/</span><span class="dv">2</span>, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb1-51"><a href="example-1-regression.html#cb1-51" tabindex="-1"></a>            <span class="at">color=</span> <span class="st">&quot;skyblue&quot;</span>, </span>
<span id="cb1-52"><a href="example-1-regression.html#cb1-52" tabindex="-1"></a>            <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-53"><a href="example-1-regression.html#cb1-53" tabindex="-1"></a>  <span class="co">#Adding the household net worth as a second(dual) y-axis</span></span>
<span id="cb1-54"><a href="example-1-regression.html#cb1-54" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>.<span class="sc">*</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1-55"><a href="example-1-regression.html#cb1-55" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-56"><a href="example-1-regression.html#cb1-56" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1-57"><a href="example-1-regression.html#cb1-57" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-58"><a href="example-1-regression.html#cb1-58" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-59"><a href="example-1-regression.html#cb1-59" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb1-60"><a href="example-1-regression.html#cb1-60" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>),</span>
<span id="cb1-61"><a href="example-1-regression.html#cb1-61" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-62"><a href="example-1-regression.html#cb1-62" tabindex="-1"></a>    <span class="at">axis.text.y.right =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-63"><a href="example-1-regression.html#cb1-63" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1-64"><a href="example-1-regression.html#cb1-64" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb1-65"><a href="example-1-regression.html#cb1-65" tabindex="-1"></a>    ) <span class="ot">-&gt;</span> p</span>
<span id="cb1-66"><a href="example-1-regression.html#cb1-66" tabindex="-1"></a></span>
<span id="cb1-67"><a href="example-1-regression.html#cb1-67" tabindex="-1"></a></span>
<span id="cb1-68"><a href="example-1-regression.html#cb1-68" tabindex="-1"></a><span class="co">#adding google font</span></span>
<span id="cb1-69"><a href="example-1-regression.html#cb1-69" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="at">name =</span> <span class="st">&quot;Henny Penny&quot;</span>, <span class="at">family =</span> <span class="st">&quot;henny&quot;</span>)</span>
<span id="cb1-70"><a href="example-1-regression.html#cb1-70" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb1-71"><a href="example-1-regression.html#cb1-71" tabindex="-1"></a></span>
<span id="cb1-72"><a href="example-1-regression.html#cb1-72" tabindex="-1"></a><span class="co">#setting font family for ggplotly </span></span>
<span id="cb1-73"><a href="example-1-regression.html#cb1-73" tabindex="-1"></a>font <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1-74"><a href="example-1-regression.html#cb1-74" tabindex="-1"></a>  <span class="at">family=</span> <span class="st">&quot;Henny Penny&quot;</span>, </span>
<span id="cb1-75"><a href="example-1-regression.html#cb1-75" tabindex="-1"></a>  <span class="at">size =</span><span class="dv">5</span></span>
<span id="cb1-76"><a href="example-1-regression.html#cb1-76" tabindex="-1"></a>  )</span>
<span id="cb1-77"><a href="example-1-regression.html#cb1-77" tabindex="-1"></a></span>
<span id="cb1-78"><a href="example-1-regression.html#cb1-78" tabindex="-1"></a><span class="co">#Plotly chart</span></span>
<span id="cb1-79"><a href="example-1-regression.html#cb1-79" tabindex="-1"></a><span class="fu">ggplotly</span>(p, <span class="at">tooltip =</span> <span class="fu">c</span>(<span class="st">&quot;text&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-80"><a href="example-1-regression.html#cb1-80" tabindex="-1"></a>  <span class="co">#Hover text of the line</span></span>
<span id="cb1-81"><a href="example-1-regression.html#cb1-81" tabindex="-1"></a>  <span class="fu">style</span>(<span class="at">text =</span> <span class="fu">glue</span>(<span class="st">&quot;{unique(p$data$country)}</span><span class="sc">\n</span><span class="st">%{unique(p$data$household)}</span><span class="sc">\n</span><span class="st">Household net worth&quot;</span>),<span class="at">traces =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-82"><a href="example-1-regression.html#cb1-82" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">font=</span>font)</span></code></pre></div>
<div class="plotly html-widget html-fill-item" id="htmlwidget-928c13659654bfde09e5" style="width:600px;height:456px;"></div>
<script type="application/json" data-for="htmlwidget-928c13659654bfde09e5">{"x":{"data":[{"orientation":"v","width":[0.89999999999999991,0.90000000000000013,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858],"base":[147.22,171.78,196.13999999999999,136.68000000000001,164.86000000000001,184.56999999999999,194.44999999999999,193.66000000000003,179.44999999999999,172.59999999999999,200,200,110.85999999999999,183.32999999999998,187.46000000000001,185.44,192.75999999999999,172.57999999999998,169.34,182.42000000000002,135.66,175.82999999999998,193.62,166.80000000000001,179.10000000000002,148.42000000000002,182.51999999999998,187.97],"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[97,97.749999999999972,98.639999999999986,94.199999999999989,92.71999999999997,96.569999999999993,98.319999999999993,98.120000000000005,93.090000000000032,91.590000000000003,100,95.620000000000005,95.150000000000006,95.480000000000018,96.340000000000003,99.379999999999995,89.949999999999989,89.75,98.799999999999983,96.879999999999995,100,98.95999999999998,97.620000000000005,94.839999999999975,97.870000000000005,86.289999999999992,95.230000000000018,95.390000000000015],"text":["AUS<br />%97<br />AGE-5<br />Childhood education","AUT<br />%97.75<br />AGE-5<br />Childhood education","BEL<br />%98.64<br />AGE-5<br />Childhood education","CHL<br />%94.2<br />AGE-5<br />Childhood education","CZE<br />%92.72<br />AGE-5<br />Childhood education","DEU<br />%96.57<br />AGE-5<br />Childhood education","DNK<br />%98.32<br />AGE-5<br />Childhood education","ESP<br />%98.12<br />AGE-5<br />Childhood education","EST<br />%93.09<br />AGE-5<br />Childhood education","FIN<br />%91.59<br />AGE-5<br />Childhood education","FRA<br />%100<br />AGE-5<br />Childhood education","GBR<br />%95.62<br />AGE-5<br />Childhood education","GRC<br />%95.15<br />AGE-5<br />Childhood education","HUN<br />%95.48<br />AGE-5<br />Childhood education","ITA<br />%96.34<br />AGE-5<br />Childhood education","JPN<br />%99.38<br />AGE-5<br />Childhood education","KOR<br />%89.95<br />AGE-5<br />Childhood education","LTU<br />%89.75<br />AGE-5<br />Childhood education","LUX<br />%98.8<br />AGE-5<br />Childhood education","LVA<br />%96.88<br />AGE-5<br />Childhood education","MEX<br />%100<br />AGE-5<br />Childhood education","NLD<br />%98.96<br />AGE-5<br />Childhood education","NOR<br />%97.62<br />AGE-5<br />Childhood education","POL<br />%94.84<br />AGE-5<br />Childhood education","PRT<br />%97.87<br />AGE-5<br />Childhood education","SVK<br />%86.29<br />AGE-5<br />Childhood education","SVN<br />%95.23<br />AGE-5<br />Childhood education","SWE<br />%95.39<br />AGE-5<br />Childhood education"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(68,1,84,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"AGE-5","legendgroup":"AGE-5","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.89999999999999991,0.90000000000000013,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858],"base":[64.950000000000003,77.849999999999994,97.870000000000005,54.969999999999999,76.969999999999999,90.019999999999996,96.430000000000007,96.120000000000005,87.269999999999996,84.5,100,100,34.899999999999999,87.170000000000002,92.060000000000002,85.439999999999998,98.799999999999997,84.469999999999999,71.409999999999997,89.090000000000003,46.789999999999999,80.719999999999999,96.379999999999995,77.609999999999999,83.680000000000007,68.290000000000006,89.489999999999995,93.390000000000001],"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[82.269999999999996,93.930000000000007,98.269999999999982,81.710000000000008,87.890000000000015,94.549999999999997,98.019999999999982,97.54000000000002,92.179999999999993,88.099999999999994,100,100,75.95999999999998,96.159999999999982,95.400000000000006,100,93.959999999999994,88.109999999999985,97.930000000000007,93.330000000000013,88.870000000000005,95.109999999999985,97.240000000000009,89.190000000000012,95.420000000000016,80.13000000000001,93.029999999999987,94.579999999999998],"text":["AUS<br />%82.27<br />AGE-4<br />Childhood education","AUT<br />%93.93<br />AGE-4<br />Childhood education","BEL<br />%98.27<br />AGE-4<br />Childhood education","CHL<br />%81.71<br />AGE-4<br />Childhood education","CZE<br />%87.89<br />AGE-4<br />Childhood education","DEU<br />%94.55<br />AGE-4<br />Childhood education","DNK<br />%98.02<br />AGE-4<br />Childhood education","ESP<br />%97.54<br />AGE-4<br />Childhood education","EST<br />%92.18<br />AGE-4<br />Childhood education","FIN<br />%88.1<br />AGE-4<br />Childhood education","FRA<br />%100<br />AGE-4<br />Childhood education","GBR<br />%100<br />AGE-4<br />Childhood education","GRC<br />%75.96<br />AGE-4<br />Childhood education","HUN<br />%96.16<br />AGE-4<br />Childhood education","ITA<br />%95.4<br />AGE-4<br />Childhood education","JPN<br />%100<br />AGE-4<br />Childhood education","KOR<br />%93.96<br />AGE-4<br />Childhood education","LTU<br />%88.11<br />AGE-4<br />Childhood education","LUX<br />%97.93<br />AGE-4<br />Childhood education","LVA<br />%93.33<br />AGE-4<br />Childhood education","MEX<br />%88.87<br />AGE-4<br />Childhood education","NLD<br />%95.11<br />AGE-4<br />Childhood education","NOR<br />%97.24<br />AGE-4<br />Childhood education","POL<br />%89.19<br />AGE-4<br />Childhood education","PRT<br />%95.42<br />AGE-4<br />Childhood education","SVK<br />%80.13<br />AGE-4<br />Childhood education","SVN<br />%93.03<br />AGE-4<br />Childhood education","SWE<br />%94.58<br />AGE-4<br />Childhood education"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(33,144,140,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"AGE-4","legendgroup":"AGE-4","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.89999999999999991,0.90000000000000013,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.90000000000000036,0.89999999999999947,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858,0.89999999999999858],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[64.950000000000003,77.849999999999994,97.870000000000005,54.969999999999999,76.969999999999999,90.019999999999996,96.430000000000007,96.120000000000005,87.269999999999996,84.5,100,100,34.899999999999999,87.170000000000002,92.060000000000002,85.439999999999998,98.799999999999997,84.469999999999999,71.409999999999997,89.090000000000003,46.789999999999999,80.719999999999999,96.379999999999995,77.609999999999999,83.680000000000007,68.290000000000006,89.489999999999995,93.390000000000001],"text":["AUS<br />%64.95<br />AGE-3<br />Childhood education","AUT<br />%77.85<br />AGE-3<br />Childhood education","BEL<br />%97.87<br />AGE-3<br />Childhood education","CHL<br />%54.97<br />AGE-3<br />Childhood education","CZE<br />%76.97<br />AGE-3<br />Childhood education","DEU<br />%90.02<br />AGE-3<br />Childhood education","DNK<br />%96.43<br />AGE-3<br />Childhood education","ESP<br />%96.12<br />AGE-3<br />Childhood education","EST<br />%87.27<br />AGE-3<br />Childhood education","FIN<br />%84.5<br />AGE-3<br />Childhood education","FRA<br />%100<br />AGE-3<br />Childhood education","GBR<br />%100<br />AGE-3<br />Childhood education","GRC<br />%34.9<br />AGE-3<br />Childhood education","HUN<br />%87.17<br />AGE-3<br />Childhood education","ITA<br />%92.06<br />AGE-3<br />Childhood education","JPN<br />%85.44<br />AGE-3<br />Childhood education","KOR<br />%98.8<br />AGE-3<br />Childhood education","LTU<br />%84.47<br />AGE-3<br />Childhood education","LUX<br />%71.41<br />AGE-3<br />Childhood education","LVA<br />%89.09<br />AGE-3<br />Childhood education","MEX<br />%46.79<br />AGE-3<br />Childhood education","NLD<br />%80.72<br />AGE-3<br />Childhood education","NOR<br />%96.38<br />AGE-3<br />Childhood education","POL<br />%77.61<br />AGE-3<br />Childhood education","PRT<br />%83.68<br />AGE-3<br />Childhood education","SVK<br />%68.29<br />AGE-3<br />Childhood education","SVN<br />%89.49<br />AGE-3<br />Childhood education","SWE<br />%93.39<br />AGE-3<br />Childhood education"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(253,231,37,1)","line":{"width":1.8897637795275593,"color":"transparent"}},"name":"AGE-3","legendgroup":"AGE-3","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[235.56,243.005,332.5,158.58500000000001,196.11500000000001,259.01999999999998,411.56,195.39500000000001,169.63499999999999,204.06999999999999,273.38,254.16499999999999,180.86500000000001,184.565,312.68000000000001,302.20999999999998,202.43000000000001,115.93000000000001,209.72499999999999,179.08500000000001,182.59999999999999,397.64999999999998,175.42500000000001,80.144999999999996,212.03999999999999,136.59,157.57499999999999,311.68000000000001],"text":["AUS<br />%97<br />AGE-5<br />Childhood education","AUT<br />%97.75<br />AGE-5<br />Childhood education","BEL<br />%98.64<br />AGE-5<br />Childhood education","CHL<br />%94.2<br />AGE-5<br />Childhood education","CZE<br />%92.72<br />AGE-5<br />Childhood education","DEU<br />%96.57<br />AGE-5<br />Childhood education","DNK<br />%98.32<br />AGE-5<br />Childhood education","ESP<br />%98.12<br />AGE-5<br />Childhood education","EST<br />%93.09<br />AGE-5<br />Childhood education","FIN<br />%91.59<br />AGE-5<br />Childhood education","FRA<br />%100<br />AGE-5<br />Childhood education","GBR<br />%95.62<br />AGE-5<br />Childhood education","GRC<br />%95.15<br />AGE-5<br />Childhood education","HUN<br />%95.48<br />AGE-5<br />Childhood education","ITA<br />%96.34<br />AGE-5<br />Childhood education","JPN<br />%99.38<br />AGE-5<br />Childhood education","KOR<br />%89.95<br />AGE-5<br />Childhood education","LTU<br />%89.75<br />AGE-5<br />Childhood education","LUX<br />%98.8<br />AGE-5<br />Childhood education","LVA<br />%96.88<br />AGE-5<br />Childhood education","MEX<br />%100<br />AGE-5<br />Childhood education","NLD<br />%98.96<br />AGE-5<br />Childhood education","NOR<br />%97.62<br />AGE-5<br />Childhood education","POL<br />%94.84<br />AGE-5<br />Childhood education","PRT<br />%97.87<br />AGE-5<br />Childhood education","SVK<br />%86.29<br />AGE-5<br />Childhood education","SVN<br />%95.23<br />AGE-5<br />Childhood education","SWE<br />%95.39<br />AGE-5<br />Childhood education"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"rgba(135,206,235,1)","dash":"solid"},"hoveron":"points","name":"AGE-5","legendgroup":"AGE-5","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[235.56,243.005,332.5,158.58500000000001,196.11500000000001,259.01999999999998,411.56,195.39500000000001,169.63499999999999,204.06999999999999,273.38,254.16499999999999,180.86500000000001,184.565,312.68000000000001,302.20999999999998,202.43000000000001,115.93000000000001,209.72499999999999,179.08500000000001,182.59999999999999,397.64999999999998,175.42500000000001,80.144999999999996,212.03999999999999,136.59,157.57499999999999,311.68000000000001],"text":["AUS<br />%82.27<br />AGE-4<br />Childhood education","AUT<br />%93.93<br />AGE-4<br />Childhood education","BEL<br />%98.27<br />AGE-4<br />Childhood education","CHL<br />%81.71<br />AGE-4<br />Childhood education","CZE<br />%87.89<br />AGE-4<br />Childhood education","DEU<br />%94.55<br />AGE-4<br />Childhood education","DNK<br />%98.02<br />AGE-4<br />Childhood education","ESP<br />%97.54<br />AGE-4<br />Childhood education","EST<br />%92.18<br />AGE-4<br />Childhood education","FIN<br />%88.1<br />AGE-4<br />Childhood education","FRA<br />%100<br />AGE-4<br />Childhood education","GBR<br />%100<br />AGE-4<br />Childhood education","GRC<br />%75.96<br />AGE-4<br />Childhood education","HUN<br />%96.16<br />AGE-4<br />Childhood education","ITA<br />%95.4<br />AGE-4<br />Childhood education","JPN<br />%100<br />AGE-4<br />Childhood education","KOR<br />%93.96<br />AGE-4<br />Childhood education","LTU<br />%88.11<br />AGE-4<br />Childhood education","LUX<br />%97.93<br />AGE-4<br />Childhood education","LVA<br />%93.33<br />AGE-4<br />Childhood education","MEX<br />%88.87<br />AGE-4<br />Childhood education","NLD<br />%95.11<br />AGE-4<br />Childhood education","NOR<br />%97.24<br />AGE-4<br />Childhood education","POL<br />%89.19<br />AGE-4<br />Childhood education","PRT<br />%95.42<br />AGE-4<br />Childhood education","SVK<br />%80.13<br />AGE-4<br />Childhood education","SVN<br />%93.03<br />AGE-4<br />Childhood education","SWE<br />%94.58<br />AGE-4<br />Childhood education"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"rgba(135,206,235,1)","dash":"solid"},"hoveron":"points","name":"AGE-4","legendgroup":"AGE-4","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],"y":[235.56,243.005,332.5,158.58500000000001,196.11500000000001,259.01999999999998,411.56,195.39500000000001,169.63499999999999,204.06999999999999,273.38,254.16499999999999,180.86500000000001,184.565,312.68000000000001,302.20999999999998,202.43000000000001,115.93000000000001,209.72499999999999,179.08500000000001,182.59999999999999,397.64999999999998,175.42500000000001,80.144999999999996,212.03999999999999,136.59,157.57499999999999,311.68000000000001],"text":["AUS<br />%471.12<br />Household net worth","AUT<br />%486.01<br />Household net worth","BEL<br />%665<br />Household net worth","CHL<br />%317.17<br />Household net worth","CZE<br />%392.23<br />Household net worth","DEU<br />%518.04<br />Household net worth","DNK<br />%823.12<br />Household net worth","ESP<br />%390.79<br />Household net worth","EST<br />%339.27<br />Household net worth","FIN<br />%408.14<br />Household net worth","FRA<br />%546.76<br />Household net worth","GBR<br />%508.33<br />Household net worth","GRC<br />%361.73<br />Household net worth","HUN<br />%369.13<br />Household net worth","ITA<br />%625.36<br />Household net worth","JPN<br />%604.42<br />Household net worth","KOR<br />%404.86<br />Household net worth","LTU<br />%231.86<br />Household net worth","LUX<br />%419.45<br />Household net worth","LVA<br />%358.17<br />Household net worth","MEX<br />%365.2<br />Household net worth","NLD<br />%795.3<br />Household net worth","NOR<br />%350.85<br />Household net worth","POL<br />%160.29<br />Household net worth","PRT<br />%424.08<br />Household net worth","SVK<br />%273.18<br />Household net worth","SVN<br />%315.15<br />Household net worth","SWE<br />%623.36<br />Household net worth"],"type":"scatter","mode":"lines","line":{"width":3.7795275590551185,"color":"rgba(135,206,235,1)","dash":"solid"},"hoveron":"points","name":"AGE-3","legendgroup":"AGE-3","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":25.613073780341267,"r":7.3059360730593621,"b":26.016039548917583,"l":10.958904109589042},"font":{"color":"rgba(0,0,0,1)","family":"Henny Penny","size":5},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[0.40000000000000002,28.600000000000001],"tickmode":"array","ticktext":["Australia","Austria","Belgium","Chile","Czechia","Germany","Denmark","Spain","Estonia","Finland","France","United Kingdom","Greece","Hungary","Italy","Japan","South Korea","Lithuania","Luxembourg","Latvia","Mexico","Netherlands","Norway","Poland","Portugal","Slovakia","Slovenia","Sweden"],"tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15.000000000000002,16,17,18,19,20,21,22,23,24,25,26,27,28],"categoryorder":"array","categoryarray":["Australia","Austria","Belgium","Chile","Czechia","Germany","Denmark","Spain","Estonia","Finland","France","United Kingdom","Greece","Hungary","Italy","Japan","South Korea","Lithuania","Luxembourg","Latvia","Mexico","Netherlands","Norway","Poland","Portugal","Slovakia","Slovenia","Sweden"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716894984},"tickangle":-60,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"y","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-20.578000000000003,432.13800000000003],"tickmode":"array","ticktext":["0","100","200","300","400"],"tickvals":[0,99.999999999999986,200,300,400],"categoryorder":"array","categoryarray":["0","100","200","300","400"],"nticks":null,"ticks":"","tickcolor":null,"ticklen":3.6529680365296811,"tickwidth":0,"showticklabels":false,"tickfont":{"color":null,"family":null,"size":0},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":false,"gridcolor":null,"gridwidth":0,"zeroline":false,"anchor":"x","title":{"text":"","font":{"color":"rgba(0,0,0,1)","family":"","size":14.611872146118724}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":null,"bordercolor":null,"borderwidth":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716894984}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"380c75a018ce":{"x":{},"y":{},"fill":{},"text":{},"type":"bar"},"380c58c01ea":{"x":{},"y":{},"fill":{},"text":{}}},"cur_data":"380c75a018ce","visdat":{"380c75a018ce":["function (y) ","x"],"380c58c01ea":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="example-1-regression.html#cb2-1" tabindex="-1"></a><span class="fu">head</span>(df_tidy)</span>
<span id="cb2-2"><a href="example-1-regression.html#cb2-2" tabindex="-1"></a><span class="do">## # A tibble: 6 × 6</span></span>
<span id="cb2-3"><a href="example-1-regression.html#cb2-3" tabindex="-1"></a><span class="do">##   country age    time childhood household country_name</span></span>
<span id="cb2-4"><a href="example-1-regression.html#cb2-4" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;       </span></span>
<span id="cb2-5"><a href="example-1-regression.html#cb2-5" tabindex="-1"></a><span class="do">## 1 AUS     AGE-3  2010      71.8      347. Australia   </span></span>
<span id="cb2-6"><a href="example-1-regression.html#cb2-6" tabindex="-1"></a><span class="do">## 2 AUS     AGE-3  2013      62.3      366. Australia   </span></span>
<span id="cb2-7"><a href="example-1-regression.html#cb2-7" tabindex="-1"></a><span class="do">## 3 AUS     AGE-3  2014      69.4      383. Australia   </span></span>
<span id="cb2-8"><a href="example-1-regression.html#cb2-8" tabindex="-1"></a><span class="do">## 4 AUS     AGE-3  2015      68.4      402. Australia   </span></span>
<span id="cb2-9"><a href="example-1-regression.html#cb2-9" tabindex="-1"></a><span class="do">## 5 AUS     AGE-3  2016      63.3      428. Australia   </span></span>
<span id="cb2-10"><a href="example-1-regression.html#cb2-10" tabindex="-1"></a><span class="do">## 6 AUS     AGE-3  2017      66.0      439. Australia</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="example-1-regression.html#cb3-1" tabindex="-1"></a><span class="co">#Splitting the data into train and test sets</span></span>
<span id="cb3-2"><a href="example-1-regression.html#cb3-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-3"><a href="example-1-regression.html#cb3-3" tabindex="-1"></a>df_split <span class="ot">&lt;-</span> </span>
<span id="cb3-4"><a href="example-1-regression.html#cb3-4" tabindex="-1"></a>  df_tidy <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="example-1-regression.html#cb3-5" tabindex="-1"></a>  <span class="co">#Converting the levels to variables for modeling</span></span>
<span id="cb3-6"><a href="example-1-regression.html#cb3-6" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> age, <span class="at">values_from =</span> childhood) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="example-1-regression.html#cb3-7" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="example-1-regression.html#cb3-8" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="example-1-regression.html#cb3-9" tabindex="-1"></a>  <span class="fu">initial_split</span>() </span>
<span id="cb3-10"><a href="example-1-regression.html#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="example-1-regression.html#cb3-11" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">training</span>(df_split)</span>
<span id="cb3-12"><a href="example-1-regression.html#cb3-12" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(df_split)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="example-1-regression.html#cb4-1" tabindex="-1"></a>df_train</span>
<span id="cb4-2"><a href="example-1-regression.html#cb4-2" tabindex="-1"></a><span class="do">## # A tibble: 216 × 7</span></span>
<span id="cb4-3"><a href="example-1-regression.html#cb4-3" tabindex="-1"></a><span class="do">##    country  time household country_name age_3 age_4 age_5</span></span>
<span id="cb4-4"><a href="example-1-regression.html#cb4-4" tabindex="-1"></a><span class="do">##    &lt;chr&gt;   &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb4-5"><a href="example-1-regression.html#cb4-5" tabindex="-1"></a><span class="do">##  1 SVN      2015      324. Slovenia      82.8  89.3  91.8</span></span>
<span id="cb4-6"><a href="example-1-regression.html#cb4-6" tabindex="-1"></a><span class="do">##  2 ITA      2014      575. Italy         92.0  96.0  97.0</span></span>
<span id="cb4-7"><a href="example-1-regression.html#cb4-7" tabindex="-1"></a><span class="do">##  3 JPN      2012      571. Japan         78    93.8  94.6</span></span>
<span id="cb4-8"><a href="example-1-regression.html#cb4-8" tabindex="-1"></a><span class="do">##  4 LUX      2011      391. Luxembourg    72.0  94.6  96.7</span></span>
<span id="cb4-9"><a href="example-1-regression.html#cb4-9" tabindex="-1"></a><span class="do">##  5 ITA      2011      500. Italy         94.4  98.7  99.6</span></span>
<span id="cb4-10"><a href="example-1-regression.html#cb4-10" tabindex="-1"></a><span class="do">##  6 ITA      2016      578. Italy         92.4  95.9  96.4</span></span>
<span id="cb4-11"><a href="example-1-regression.html#cb4-11" tabindex="-1"></a><span class="do">##  7 ESP      2017      392. Spain         96.4  97.7  97.1</span></span>
<span id="cb4-12"><a href="example-1-regression.html#cb4-12" tabindex="-1"></a><span class="do">##  8 GRC      2019      362. Greece        34.9  76.0  95.2</span></span>
<span id="cb4-13"><a href="example-1-regression.html#cb4-13" tabindex="-1"></a><span class="do">##  9 DEU      2015      469. Germany       93.3  96.7  98.1</span></span>
<span id="cb4-14"><a href="example-1-regression.html#cb4-14" tabindex="-1"></a><span class="do">## 10 LTU      2012      203. Lithuania     71.4  75    77.0</span></span>
<span id="cb4-15"><a href="example-1-regression.html#cb4-15" tabindex="-1"></a><span class="do">## # ℹ 206 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="example-1-regression.html#cb5-1" tabindex="-1"></a><span class="co">#install.packages(&quot;dbarts&quot;)</span></span>
<span id="cb5-2"><a href="example-1-regression.html#cb5-2" tabindex="-1"></a><span class="fu">library</span>(dbarts)</span>
<span id="cb5-3"><a href="example-1-regression.html#cb5-3" tabindex="-1"></a><span class="co">#Preprocessing</span></span>
<span id="cb5-4"><a href="example-1-regression.html#cb5-4" tabindex="-1"></a>df_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(household <span class="sc">~</span> age_3 <span class="sc">+</span> age_4 <span class="sc">+</span> age_5, <span class="at">data =</span> df_train) </span>
<span id="cb5-5"><a href="example-1-regression.html#cb5-5" tabindex="-1"></a></span>
<span id="cb5-6"><a href="example-1-regression.html#cb5-6" tabindex="-1"></a><span class="co">#Modeling with BART</span></span>
<span id="cb5-7"><a href="example-1-regression.html#cb5-7" tabindex="-1"></a>df_spec <span class="ot">&lt;-</span> </span>
<span id="cb5-8"><a href="example-1-regression.html#cb5-8" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">bart</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="example-1-regression.html#cb5-9" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;dbarts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="example-1-regression.html#cb5-10" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)  </span>
<span id="cb5-11"><a href="example-1-regression.html#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="example-1-regression.html#cb5-12" tabindex="-1"></a><span class="co">#Workflow</span></span>
<span id="cb5-13"><a href="example-1-regression.html#cb5-13" tabindex="-1"></a>df_wf <span class="ot">&lt;-</span> </span>
<span id="cb5-14"><a href="example-1-regression.html#cb5-14" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-15"><a href="example-1-regression.html#cb5-15" tabindex="-1"></a>  <span class="fu">add_recipe</span>(df_rec) <span class="sc">%&gt;%</span> </span>
<span id="cb5-16"><a href="example-1-regression.html#cb5-16" tabindex="-1"></a>  <span class="fu">add_model</span>(df_spec)</span>
<span id="cb5-17"><a href="example-1-regression.html#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="example-1-regression.html#cb5-18" tabindex="-1"></a><span class="co">#cross-validation for resamples</span></span>
<span id="cb5-19"><a href="example-1-regression.html#cb5-19" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb5-20"><a href="example-1-regression.html#cb5-20" tabindex="-1"></a>df_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(df_train)</span>
<span id="cb5-21"><a href="example-1-regression.html#cb5-21" tabindex="-1"></a></span>
<span id="cb5-22"><a href="example-1-regression.html#cb5-22" tabindex="-1"></a><span class="co">#Resampling for the accuracy metrics</span></span>
<span id="cb5-23"><a href="example-1-regression.html#cb5-23" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">98765</span>)</span>
<span id="cb5-24"><a href="example-1-regression.html#cb5-24" tabindex="-1"></a>df_rs <span class="ot">&lt;-</span> </span>
<span id="cb5-25"><a href="example-1-regression.html#cb5-25" tabindex="-1"></a>  df_wf <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="example-1-regression.html#cb5-26" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(<span class="at">resamples =</span> df_folds)</span>
<span id="cb5-27"><a href="example-1-regression.html#cb5-27" tabindex="-1"></a></span>
<span id="cb5-28"><a href="example-1-regression.html#cb5-28" tabindex="-1"></a><span class="co">#Computes the accuracy metrics  </span></span>
<span id="cb5-29"><a href="example-1-regression.html#cb5-29" tabindex="-1"></a><span class="fu">collect_metrics</span>(df_rs)</span>
<span id="cb5-30"><a href="example-1-regression.html#cb5-30" tabindex="-1"></a><span class="do">## # A tibble: 2 × 6</span></span>
<span id="cb5-31"><a href="example-1-regression.html#cb5-31" tabindex="-1"></a><span class="do">##   .metric .estimator   mean     n std_err .config             </span></span>
<span id="cb5-32"><a href="example-1-regression.html#cb5-32" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb5-33"><a href="example-1-regression.html#cb5-33" tabindex="-1"></a><span class="do">## 1 rmse    standard   85.2      10  4.79   Preprocessor1_Model1</span></span>
<span id="cb5-34"><a href="example-1-regression.html#cb5-34" tabindex="-1"></a><span class="do">## 2 rsq     standard    0.528    10  0.0458 Preprocessor1_Model1</span></span>
<span id="cb5-35"><a href="example-1-regression.html#cb5-35" tabindex="-1"></a></span>
<span id="cb5-36"><a href="example-1-regression.html#cb5-36" tabindex="-1"></a><span class="co"># A tibble: 2 x 6</span></span>
<span id="cb5-37"><a href="example-1-regression.html#cb5-37" tabindex="-1"></a><span class="co">#  .metric .estimator   mean     n std_err .config             </span></span>
<span id="cb5-38"><a href="example-1-regression.html#cb5-38" tabindex="-1"></a><span class="co">#  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb5-39"><a href="example-1-regression.html#cb5-39" tabindex="-1"></a><span class="co">#1 rmse    standard   85.2      10  4.79   Preprocessor1_Model1</span></span>
<span id="cb5-40"><a href="example-1-regression.html#cb5-40" tabindex="-1"></a><span class="co">#2 rsq     standard    0.528    10  0.0458 Preprocessor1_Model1</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="example-1-regression.html#cb6-1" tabindex="-1"></a><span class="co">#Model tuning with grid search</span></span>
<span id="cb6-2"><a href="example-1-regression.html#cb6-2" tabindex="-1"></a>df_spec <span class="ot">&lt;-</span> </span>
<span id="cb6-3"><a href="example-1-regression.html#cb6-3" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">bart</span>(</span>
<span id="cb6-4"><a href="example-1-regression.html#cb6-4" tabindex="-1"></a>    <span class="at">trees =</span> <span class="fu">tune</span>(),</span>
<span id="cb6-5"><a href="example-1-regression.html#cb6-5" tabindex="-1"></a>    <span class="at">prior_terminal_node_coef =</span> <span class="fu">tune</span>(),</span>
<span id="cb6-6"><a href="example-1-regression.html#cb6-6" tabindex="-1"></a>    <span class="at">prior_terminal_node_expo =</span> <span class="fu">tune</span>()</span>
<span id="cb6-7"><a href="example-1-regression.html#cb6-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-8"><a href="example-1-regression.html#cb6-8" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;dbarts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="example-1-regression.html#cb6-9" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb6-10"><a href="example-1-regression.html#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="example-1-regression.html#cb6-11" tabindex="-1"></a><span class="co">#parameter object</span></span>
<span id="cb6-12"><a href="example-1-regression.html#cb6-12" tabindex="-1"></a>rf_param <span class="ot">&lt;-</span> </span>
<span id="cb6-13"><a href="example-1-regression.html#cb6-13" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="example-1-regression.html#cb6-14" tabindex="-1"></a>  <span class="fu">add_model</span>(df_spec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="example-1-regression.html#cb6-15" tabindex="-1"></a>  <span class="fu">add_recipe</span>(df_rec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-16"><a href="example-1-regression.html#cb6-16" tabindex="-1"></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-17"><a href="example-1-regression.html#cb6-17" tabindex="-1"></a>  <span class="fu">finalize</span>(df_train)</span>
<span id="cb6-18"><a href="example-1-regression.html#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="example-1-regression.html#cb6-19" tabindex="-1"></a><span class="co">#space-filling design with integer grid argument</span></span>
<span id="cb6-20"><a href="example-1-regression.html#cb6-20" tabindex="-1"></a>df_reg_tune <span class="ot">&lt;-</span></span>
<span id="cb6-21"><a href="example-1-regression.html#cb6-21" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-22"><a href="example-1-regression.html#cb6-22" tabindex="-1"></a>  <span class="fu">add_recipe</span>(df_rec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-23"><a href="example-1-regression.html#cb6-23" tabindex="-1"></a>  <span class="fu">add_model</span>(df_spec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-24"><a href="example-1-regression.html#cb6-24" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb6-25"><a href="example-1-regression.html#cb6-25" tabindex="-1"></a>    df_folds,</span>
<span id="cb6-26"><a href="example-1-regression.html#cb6-26" tabindex="-1"></a>    <span class="at">grid =</span> <span class="dv">20</span>,</span>
<span id="cb6-27"><a href="example-1-regression.html#cb6-27" tabindex="-1"></a>    <span class="at">param_info =</span> rf_param,</span>
<span id="cb6-28"><a href="example-1-regression.html#cb6-28" tabindex="-1"></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(rsq)</span>
<span id="cb6-29"><a href="example-1-regression.html#cb6-29" tabindex="-1"></a>  )</span>
<span id="cb6-30"><a href="example-1-regression.html#cb6-30" tabindex="-1"></a></span>
<span id="cb6-31"><a href="example-1-regression.html#cb6-31" tabindex="-1"></a><span class="co">#Selecting the best parameters according to the r-square</span></span>
<span id="cb6-32"><a href="example-1-regression.html#cb6-32" tabindex="-1"></a>rf_param_best <span class="ot">&lt;-</span> </span>
<span id="cb6-33"><a href="example-1-regression.html#cb6-33" tabindex="-1"></a>  <span class="fu">select_best</span>(df_reg_tune, <span class="at">metric =</span> <span class="st">&quot;rsq&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-34"><a href="example-1-regression.html#cb6-34" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>.config)</span>
<span id="cb6-35"><a href="example-1-regression.html#cb6-35" tabindex="-1"></a></span>
<span id="cb6-36"><a href="example-1-regression.html#cb6-36" tabindex="-1"></a><span class="co">#Final estimation with the object of best parameters</span></span>
<span id="cb6-37"><a href="example-1-regression.html#cb6-37" tabindex="-1"></a>final_df_wflow <span class="ot">&lt;-</span> </span>
<span id="cb6-38"><a href="example-1-regression.html#cb6-38" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-39"><a href="example-1-regression.html#cb6-39" tabindex="-1"></a>  <span class="fu">add_model</span>(df_spec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-40"><a href="example-1-regression.html#cb6-40" tabindex="-1"></a>  <span class="fu">add_recipe</span>(df_rec) <span class="sc">%&gt;%</span> </span>
<span id="cb6-41"><a href="example-1-regression.html#cb6-41" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(rf_param_best)</span>
<span id="cb6-42"><a href="example-1-regression.html#cb6-42" tabindex="-1"></a></span>
<span id="cb6-43"><a href="example-1-regression.html#cb6-43" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb6-44"><a href="example-1-regression.html#cb6-44" tabindex="-1"></a>final_df_fit <span class="ot">&lt;-</span> </span>
<span id="cb6-45"><a href="example-1-regression.html#cb6-45" tabindex="-1"></a>  final_df_wflow <span class="sc">%&gt;%</span> </span>
<span id="cb6-46"><a href="example-1-regression.html#cb6-46" tabindex="-1"></a>  <span class="fu">last_fit</span>(df_split)</span>
<span id="cb6-47"><a href="example-1-regression.html#cb6-47" tabindex="-1"></a></span>
<span id="cb6-48"><a href="example-1-regression.html#cb6-48" tabindex="-1"></a><span class="co">#Computes final the accuracy metrics </span></span>
<span id="cb6-49"><a href="example-1-regression.html#cb6-49" tabindex="-1"></a><span class="fu">collect_metrics</span>(final_df_fit)</span>
<span id="cb6-50"><a href="example-1-regression.html#cb6-50" tabindex="-1"></a><span class="do">## # A tibble: 2 × 4</span></span>
<span id="cb6-51"><a href="example-1-regression.html#cb6-51" tabindex="-1"></a><span class="do">##   .metric .estimator .estimate .config             </span></span>
<span id="cb6-52"><a href="example-1-regression.html#cb6-52" tabindex="-1"></a><span class="do">##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb6-53"><a href="example-1-regression.html#cb6-53" tabindex="-1"></a><span class="do">## 1 rmse    standard      88.6   Preprocessor1_Model1</span></span>
<span id="cb6-54"><a href="example-1-regression.html#cb6-54" tabindex="-1"></a><span class="do">## 2 rsq     standard       0.616 Preprocessor1_Model1</span></span>
<span id="cb6-55"><a href="example-1-regression.html#cb6-55" tabindex="-1"></a></span>
<span id="cb6-56"><a href="example-1-regression.html#cb6-56" tabindex="-1"></a><span class="co"># A tibble: 2 x 4</span></span>
<span id="cb6-57"><a href="example-1-regression.html#cb6-57" tabindex="-1"></a><span class="co">#  .metric .estimator .estimate .config             </span></span>
<span id="cb6-58"><a href="example-1-regression.html#cb6-58" tabindex="-1"></a><span class="co">#  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb6-59"><a href="example-1-regression.html#cb6-59" tabindex="-1"></a><span class="co">#1 rmse    standard      84.5   Preprocessor1_Model1</span></span>
<span id="cb6-60"><a href="example-1-regression.html#cb6-60" tabindex="-1"></a><span class="co">#2 rsq     standard       0.645 Preprocessor1_Model1</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="example-1-regression.html#cb7-1" tabindex="-1"></a><span class="co">#Creating a preprocessed dataframe of the train dataset</span></span>
<span id="cb7-2"><a href="example-1-regression.html#cb7-2" tabindex="-1"></a>imp_data <span class="ot">&lt;-</span> </span>
<span id="cb7-3"><a href="example-1-regression.html#cb7-3" tabindex="-1"></a>  df_rec <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="example-1-regression.html#cb7-4" tabindex="-1"></a>  <span class="fu">prep</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="example-1-regression.html#cb7-5" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>)</span>
<span id="cb7-6"><a href="example-1-regression.html#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="example-1-regression.html#cb7-7" tabindex="-1"></a><span class="co">#Final modeling with the best parameters</span></span>
<span id="cb7-8"><a href="example-1-regression.html#cb7-8" tabindex="-1"></a>df_spec_final <span class="ot">&lt;-</span> </span>
<span id="cb7-9"><a href="example-1-regression.html#cb7-9" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">bart</span>(</span>
<span id="cb7-10"><a href="example-1-regression.html#cb7-10" tabindex="-1"></a>    <span class="at">trees =</span> <span class="dv">80</span>,</span>
<span id="cb7-11"><a href="example-1-regression.html#cb7-11" tabindex="-1"></a>    <span class="at">prior_terminal_node_coef =</span> <span class="fl">0.884</span>,</span>
<span id="cb7-12"><a href="example-1-regression.html#cb7-12" tabindex="-1"></a>    <span class="at">prior_terminal_node_expo =</span> <span class="fl">0.713</span></span>
<span id="cb7-13"><a href="example-1-regression.html#cb7-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="example-1-regression.html#cb7-14" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;dbarts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="example-1-regression.html#cb7-15" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb7-16"><a href="example-1-regression.html#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="example-1-regression.html#cb7-17" tabindex="-1"></a><span class="co">#building the explainer-object</span></span>
<span id="cb7-18"><a href="example-1-regression.html#cb7-18" tabindex="-1"></a>explainer_df <span class="ot">&lt;-</span> </span>
<span id="cb7-19"><a href="example-1-regression.html#cb7-19" tabindex="-1"></a>  <span class="fu">explain_tidymodels</span>(</span>
<span id="cb7-20"><a href="example-1-regression.html#cb7-20" tabindex="-1"></a>    df_spec_final <span class="sc">%&gt;%</span> </span>
<span id="cb7-21"><a href="example-1-regression.html#cb7-21" tabindex="-1"></a>      <span class="fu">fit</span>(household <span class="sc">~</span> ., <span class="at">data =</span> imp_data),</span>
<span id="cb7-22"><a href="example-1-regression.html#cb7-22" tabindex="-1"></a>    <span class="at">data =</span> imp_data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>household), </span>
<span id="cb7-23"><a href="example-1-regression.html#cb7-23" tabindex="-1"></a>    <span class="at">y =</span> df_train<span class="sc">$</span>household,</span>
<span id="cb7-24"><a href="example-1-regression.html#cb7-24" tabindex="-1"></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb7-25"><a href="example-1-regression.html#cb7-25" tabindex="-1"></a>  )</span>
<span id="cb7-26"><a href="example-1-regression.html#cb7-26" tabindex="-1"></a></span>
<span id="cb7-27"><a href="example-1-regression.html#cb7-27" tabindex="-1"></a></span>
<span id="cb7-28"><a href="example-1-regression.html#cb7-28" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1983</span>)</span>
<span id="cb7-29"><a href="example-1-regression.html#cb7-29" tabindex="-1"></a><span class="co">#calculates the variable-importance measure</span></span>
<span id="cb7-30"><a href="example-1-regression.html#cb7-30" tabindex="-1"></a>vip_df <span class="ot">&lt;-</span> </span>
<span id="cb7-31"><a href="example-1-regression.html#cb7-31" tabindex="-1"></a>  <span class="fu">model_parts</span>( </span>
<span id="cb7-32"><a href="example-1-regression.html#cb7-32" tabindex="-1"></a>    <span class="at">explainer =</span> explainer_df, </span>
<span id="cb7-33"><a href="example-1-regression.html#cb7-33" tabindex="-1"></a>    <span class="at">loss_function =</span> loss_root_mean_square, </span>
<span id="cb7-34"><a href="example-1-regression.html#cb7-34" tabindex="-1"></a>    <span class="at">B =</span> <span class="dv">100</span>, <span class="co">#the number of permutations</span></span>
<span id="cb7-35"><a href="example-1-regression.html#cb7-35" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;difference&quot;</span>,</span>
<span id="cb7-36"><a href="example-1-regression.html#cb7-36" tabindex="-1"></a>    <span class="at">label =</span><span class="st">&quot;&quot;</span></span>
<span id="cb7-37"><a href="example-1-regression.html#cb7-37" tabindex="-1"></a>  )</span>
<span id="cb7-38"><a href="example-1-regression.html#cb7-38" tabindex="-1"></a></span>
<span id="cb7-39"><a href="example-1-regression.html#cb7-39" tabindex="-1"></a><span class="co">#Plotting ranking of the importance of explanatory variables</span></span>
<span id="cb7-40"><a href="example-1-regression.html#cb7-40" tabindex="-1"></a><span class="fu">plot</span>(vip_df) <span class="sc">+</span></span>
<span id="cb7-41"><a href="example-1-regression.html#cb7-41" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Mean variable-importance over 100 permutations&quot;</span>, <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb7-42"><a href="example-1-regression.html#cb7-42" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb7-43"><a href="example-1-regression.html#cb7-43" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>),</span>
<span id="cb7-44"><a href="example-1-regression.html#cb7-44" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-7-1.png" width="600" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="example-1-regression.html#cb8-1" tabindex="-1"></a><span class="co">#Partial dependence profiles for 4-years old students</span></span>
<span id="cb8-2"><a href="example-1-regression.html#cb8-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2403</span>)</span>
<span id="cb8-3"><a href="example-1-regression.html#cb8-3" tabindex="-1"></a>pdp_age <span class="ot">&lt;-</span> <span class="fu">model_profile</span>(explainer_df, <span class="at">variables =</span> <span class="st">&quot;age_4&quot;</span>)</span>
<span id="cb8-4"><a href="example-1-regression.html#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="example-1-regression.html#cb8-5" tabindex="-1"></a><span class="fu">as_tibble</span>(pdp_age<span class="sc">$</span>agr_profiles) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="example-1-regression.html#cb8-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="st">`</span><span class="at">_x_</span><span class="st">`</span>, <span class="st">`</span><span class="at">_yhat_</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb8-7"><a href="example-1-regression.html#cb8-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">as_tibble</span>(pdp_age<span class="sc">$</span>cp_profiles),</span>
<span id="cb8-8"><a href="example-1-regression.html#cb8-8" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> age_4, <span class="at">group =</span> <span class="st">`</span><span class="at">_ids_</span><span class="st">`</span>),</span>
<span id="cb8-9"><a href="example-1-regression.html#cb8-9" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>, <span class="at">color =</span> <span class="st">&quot;gray50&quot;</span>)<span class="sc">+</span></span>
<span id="cb8-10"><a href="example-1-regression.html#cb8-10" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;midnightblue&quot;</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb8-11"><a href="example-1-regression.html#cb8-11" tabindex="-1"></a>  <span class="fu">bbc_style</span>()<span class="sc">+</span> </span>
<span id="cb8-12"><a href="example-1-regression.html#cb8-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">&quot;Household vs. AGE-4&quot;</span>)<span class="sc">+</span></span>
<span id="cb8-13"><a href="example-1-regression.html#cb8-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb8-14"><a href="example-1-regression.html#cb8-14" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color=</span><span class="st">&quot;grey&quot;</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-8-1.png" width="600" style="display: block; margin: auto;" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-methodology.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="example-2-classification.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/edit/main/03-example.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/YOUR GITHUB USERNAME/YOUR REPO NAME/blob/main/03-example.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
